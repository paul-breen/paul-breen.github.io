(function(c){var b=false;var a={touch:{pan:"xy",scale:"xy",autoWidth:true,autoHeight:true}};function d(l){var o=false;var k=false;var e={x:-1,y:-1};var m=0;var j={x:0,y:0};var n=1;var r={x:50,y:50};function q(u){var t=l.getPlaceholder();var s=l.getOptions();j.x-=u.x;j.y-=u.y;switch(s.touch.pan.toLowerCase()){case"x":t.children("div.flot-touch-container").css("-webkit-transform","translateX("+j.x+"px)");break;case"y":t.children("div.flot-touch-container").css("-webkit-transform","translateY("+j.y+"px)");break;default:t.children("div.flot-touch-container").css("-webkit-transform","translate("+j.x+"px,"+j.y+"px)");break}}function g(v){var u=l.getPlaceholder();var t=l.getOptions();var s=u.children("div.flot-touch-container");n*=1+(v/100);switch(t.touch.scale.toLowerCase()){case"x":s.css("-webkit-transform","scaleX("+n+")");break;case"y":s.css("-webkit-transform","scaleY("+n+")");break;default:s.css("-webkit-transform","scale("+n+")");break}}function p(v,u){var w=v.getPlaceholder();if(u.touch.autoWidth){w.css("width","100%")}if(u.touch.autoHeight){var t=w.parent();var s=0;t.siblings().each(function(){s-=c(this).outerHeight()});s-=parseInt(t.css("padding-top"),10);s-=parseInt(t.css("padding-bottom"),10);s+=window.innerHeight;w.css("height",(s<=0)?100:s+"px")}}function i(u,t){var v=u.getPlaceholder();var s=c('<div class="flot-touch-container" style="background:#fff;"/>');v.css({background:"#fff url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////mpqaPjL2kgAAABdJREFUeNpiYIQCBhgYIIEBth4mABBgAEUQAIEfdL0YAAAAAElFTkSuQmCC) repeat",overflow:"hidden"}).children("canvas").wrapAll(s);v.bind("touchstart",function(x){var A=x.originalEvent.touches;var w=v.children("div.flot-touch-container");if(A.length===1){o=true;e={x:A[0].pageX,y:A[0].pageY};m=0}else{if(A.length===2){k=true;e={x:(A[0].pageX+A[1].pageX)/2,y:(A[0].pageY+A[1].pageY)/2};m=Math.sqrt(Math.pow(A[1].pageX-A[0].pageX,2)+Math.pow(A[1].pageY-A[0].pageY,2))}}var B=v.offset();var z={x:B.left,y:B.top,width:v.width(),height:v.height()};var y={x:e.x,y:e.y};if(y.x<z.x){y.x=z.x}else{if(y.x>z.x+z.width){y.x=z.x+z.width}}if(y.y<z.y){y.y=z.y}else{if(y.y>z.y+z.height){y.y=z.y+z.height}}r={x:Math.round((y.x/z.width)*100),y:Math.round((y.y/z.height)*100)};w.css("-webkit-transform-origin",r.x+"% "+r.y+"%");return false});v.bind("touchmove",function(x){var y=x.originalEvent.touches;var w,A,z;if(o&&y.length===1){w={x:y[0].pageX,y:y[0].pageY};z={x:e.x-w.x,y:e.y-w.y};q(z);e=w;m=0}else{if(k&&y.length===2){A=Math.sqrt(Math.pow(y[1].pageX-y[0].pageX,2)+Math.pow(y[1].pageY-y[0].pageY,2));w={x:(y[0].pageX+y[1].pageX)/2,y:(y[0].pageY+y[1].pageY)/2};z=A-m;g(z);e=w;m=A}}});v.bind("touchend",function(y){var D=u.getPlaceholder();var B=u.getOptions();var x=D.children("div.flot-touch-container");if(j.x!==0||j.y!==0){c.each(u.getAxes(),function(F,H){if(H.direction===B.touch.pan.toLowerCase()||B.touch.pan.toLowerCase()=="xy"){var G=H.c2p(H.p2c(H.min)-j[H.direction]);var E=H.c2p(H.p2c(H.max)-j[H.direction]);H.options.min=G;H.options.max=E}})}if(n!==1){var C=u.width();var w=u.height();var A={x:Math.round((r.x/100)*C),y:Math.round((r.y/100)*w)};var z={x:{min:A.x-(r.x/100)*C/n,max:A.x+(1-(r.x/100))*C/n},y:{min:A.y-(r.y/100)*w/n,max:A.y+(1-(r.y/100))*w/n}};c.each(u.getAxes(),function(G,I){if(I.direction===B.touch.scale.toLowerCase()||B.touch.scale.toLowerCase()=="xy"){var H=I.c2p(z[I.direction].min);var E=I.c2p(z[I.direction].max);if(H>E){var F=H;H=E;E=F}I.options.min=H;I.options.max=E}})}u.setupGrid();u.draw();o=false;k=false;e={x:-1,y:-1};m=0;j={x:0,y:0};n=1;r={x:50,y:50};x.css({"-webkit-transform":"translate("+j.x+"px,"+j.y+"px) scale("+n+")","-webkit-transform-origin":r.x+"% "+r.y+"%"})})}function f(u,s,t){if(window.devicePixelRatio){var v=u.getPlaceholder();v.children("canvas").each(function(y,x){var z=x.getContext("2d");var A=c(x).attr("width");var w=c(x).attr("height");c(x).attr("width",A*window.devicePixelRatio);c(x).attr("height",w*window.devicePixelRatio);c(x).css("width",A+"px");c(x).css("height",w+"px");z.scale(window.devicePixelRatio,window.devicePixelRatio)})}}function h(t,s){var u=t.getPlaceholder();u.unbind("touchstart").unbind("touchmove").unbind("touchend")}l.hooks.processOptions.push(p);l.hooks.bindEvents.push(i);l.hooks.processDatapoints.push(f);l.hooks.shutdown.push(h);if(!b){c(document).bind("ready orientationchange",function(s){window.scrollTo(0,1);setTimeout(function(){c.plot(placeholder,l.getData(),l.getOptions())},50)});b=true}}c.plot.plugins.push({init:d,options:a,name:"touch",version:"1.0"})})(jQuery);